{% load partials %}
{% load static %}
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Valkey Pub/Sub</title>
	<script src="{% static 'js/htmx.min.js' %}"></script>
	<script src="{% static 'js/htmx-ext-sse.min.js' %}"></script>
</head>
<body>
	<h1>Valkey IPC Publish Subscribe</h1>
	<h2>Username: {{ username }}</h2>
	<h2>Task Count: {{ task_count }}</h2>
	<form
		hx-post="{% url 'valkey' %}"
		hx-swap="none">
		{% csrf_token %}
		<button>Submit</button>
	</form>
	<hr>
	<div hx-ext="sse" sse-connect="{% url 'valkeysse' %}" sse-close="disconnected">
		<div hx-get="{% url 'valkey' %}?p=current_time" hx-trigger="sse:current_time" hx-target="#currentTime">
		{% partialdef current_time %}
			<p id="currentTime">{{ current_time }}</p>
		{% endpartialdef %}
		</div>
		{% partial current_time %}
		<div hx-get="{% url 'valkey' %}?p=pong" hx-trigger="every 5secs" hx-swap="none"></div>
	</div>
</body>
</html>