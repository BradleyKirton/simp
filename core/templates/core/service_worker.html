<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Service Workers</title>
</head>

<body>
	<h1 id="header">Service Workers</h1>
	<script>
		const registerServiceWorker = async () => {
			if ("serviceWorker" in navigator) {
				try {
					const registration = await navigator.serviceWorker.register("{% url 'swjs' %}", {
						scope: "/sw/",
					});
					if (registration.installing) {
						console.log("Service worker installing");
					} else if (registration.waiting) {
						console.log("Service worker installed");
					} else if (registration.active) {
						console.log("Service worker active");
					}
				} catch (error) {
					console.error(`Registration failed with ${error}`);
				}
				navigator.serviceWorker.addEventListener('message', function(event) {
				    const data = event.data;
				    console.log('Message from service worker:', data);
				    // Handle the message as needed
				});
			}
		};
		registerServiceWorker();

		window.addEventListener("offline", (event) => {
		  document.getElementById("header").style = "color: red;"
		});
		window.addEventListener("online", (event) => {
		  document.getElementById("header").style = "color: black;"
		});
		if (navigator.onLine) {
			document.getElementById("header").style = "color: black;"
		} else {
			document.getElementById("header").style = "color: red;"
		}
	</script>

	<script>
		navigator.setAppBadge(2);

		async function checkProperties() {
		  const supportedProperties = await navigator.contacts.getProperties();
		  if (supportedProperties.includes("name")) {
		    console.log("name")
		  }
		  if (supportedProperties.includes("email")) {
		    console.log("email")
		  }
		  if (supportedProperties.includes("tel")) {
		    console.log("tel")
		  }
		  if (supportedProperties.includes("address")) {
		    console.log("address")
		  }
		  if (supportedProperties.includes("icon")) {
		    console.log("icon")
		  }
		}

		navigator.getBattery().then((battery) => {
		  function updateAllBatteryInfo() {
		    updateChargeInfo();
		    updateLevelInfo();
		    updateChargingInfo();
		    updateDischargingInfo();
		  }
		  updateAllBatteryInfo();

		  battery.addEventListener("chargingchange", () => {
		    updateChargeInfo();
		  });
		  function updateChargeInfo() {
		    console.log(`Battery charging? ${battery.charging ? "Yes" : "No"}`);
		  }

		  battery.addEventListener("levelchange", () => {
		    updateLevelInfo();
		  });
		  function updateLevelInfo() {
		    console.log(`Battery level: ${battery.level * 100}%`);
		  }

		  battery.addEventListener("chargingtimechange", () => {
		    updateChargingInfo();
		  });
		  function updateChargingInfo() {
		    console.log(`Battery charging time: ${battery.chargingTime} seconds`);
		  }

		  battery.addEventListener("dischargingtimechange", () => {
		    updateDischargingInfo();
		  });
		  function updateDischargingInfo() {
		    console.log(`Battery discharging time: ${battery.dischargingTime} seconds`);
		  }
		});

	</script>
</body>

</html>